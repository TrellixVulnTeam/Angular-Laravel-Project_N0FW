{"ast":null,"code":"import { ofType, createEffect } from '@ngrx/effects';\nimport { of } from 'rxjs';\nimport { switchMap, map, filter, catchError, exhaustMap } from 'rxjs/operators';\nimport { ROUTER_NAVIGATION } from '@ngrx/router-store';\nimport { ShowAllProductsAction, GetProductsAction, ProductsTypeActionSuccess, GetSingleProductActionFail, ProductsTypeActionFail, GetSingleProductActionSuccess, GetSingleProductAction } from '../actions/products.actions';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ngrx/effects\";\nimport * as i2 from \"src/app/services/products.service\";\nimport * as i3 from \"@ngrx/store\";\nexport let ProductsEffect = /*#__PURE__*/(() => {\n  class ProductsEffect {\n    constructor(actions$, products_service, store) {\n      this.actions$ = actions$;\n      this.products_service = products_service;\n      this.store = store;\n      this.loadAllProducts$ = createEffect(() => {\n        return this.actions$.pipe(ofType(ShowAllProductsAction), switchMap(() => this.products_service.getAll()), map(productsResp => GetProductsAction({\n          products: productsResp\n        })));\n      });\n      this.loadSingleProducts$ = createEffect(() => {\n        return this.actions$.pipe(ofType(GetSingleProductAction), exhaustMap(action => this.products_service.getSingleProduct(action.item_id).pipe(map(product => GetSingleProductActionSuccess({\n          products: product\n        })))), catchError(errorResp => {\n          return of(GetSingleProductActionFail({\n            message: errorResp.error.message\n          }));\n        }));\n      });\n      this.loadProductsType$ = createEffect(() => {\n        return this.actions$.pipe(ofType(ROUTER_NAVIGATION), filter(r => {\n          return r.payload.routerState.url.startsWith('/products');\n        }), map(r => {\n          var _a;\n\n          return (_a = r.payload.routerState.root.firstChild) === null || _a === void 0 ? void 0 : _a.params['type'];\n        }), switchMap(type => {\n          if (type == undefined) {\n            return this.products_service.getAll().pipe(map(data => {\n              return GetProductsAction({\n                products: data\n              });\n            }));\n          } else {\n            return this.products_service.getProductsType(type).pipe(map(data => {\n              return ProductsTypeActionSuccess({\n                products: data\n              });\n            }));\n          }\n        }), catchError(errorResp => {\n          return of(ProductsTypeActionFail({\n            message: errorResp.error.message\n          }));\n        }));\n      });\n    }\n\n  }\n\n  ProductsEffect.ɵfac = function ProductsEffect_Factory(t) {\n    return new (t || ProductsEffect)(i0.ɵɵinject(i1.Actions), i0.ɵɵinject(i2.ProductsService), i0.ɵɵinject(i3.Store));\n  };\n\n  ProductsEffect.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: ProductsEffect,\n    factory: ProductsEffect.ɵfac\n  });\n  return ProductsEffect;\n})();","map":null,"metadata":{},"sourceType":"module"}